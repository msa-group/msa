export default {"apig.http":"# 路由分组\nHttpApi:\n  Type: ALIYUN::APIG::HttpApi\n  MsaResource: true\n  Properties:\n    HttpApiName: {{Parameters.Name}}\n    Type: Http\n    BasePath: {{Default(Parameters.BasePath, '/')}}\n    Protocols: '[\"HTTP\", \"HTTPS\"]'\n\n\n{{#each Default(Parameters.Routes, [])}}\n# 路由配置\nRoute{{index}}:\n  Type: ALIYUN::APIG::Route\n  Properties:\n    HttpApiId: {{RosOutput(HttpApi, \"HttpApiId\")}}\n    RouteName: {{item.Name}}\n    EnvironmentInfo: '{\"EnvironmentId\": \"{{Parameters.EnvironmentId}}\"}'\n    Match: '{\"Path\": {\"Type\":\"{{item.Path.Type}}\", \"Value\": \"{{item.Path.Value}}\"}, \"Methods\": {{Default(item.Methods, [])}}}'\n    Backend: {{RosRouterServices(item.Services, item.Scene)}}\n# 路由发布\nPublishRoute{{index}}:\n  DependsOn:\n    - {{Join([\"Route\", index])}}\n  Type: ALIYUN::APIG::ApiAttachment\n  Properties:\n    EnvironmentId: {{Parameters.EnvironmentId}}\n    BackendScene: {{item.Scene}}\n    RouteId:\n      Fn::GetAtt:\n      - {{Join([\"Route\", index])}}\n      - RouteId\n    HttpApiId: {{RosOutput(HttpApi, \"HttpApiId\")}}\n    ServiceConfigs: '[{\"ServiceId\":\"mockServie\",\"Weight\":100}]'\n{{#each Default(item.Policies, [])}}\nPolicy{{Join([item.parent.index, index])}}:\n  DependsOn:\n      - {{Join([\"Route\", item.parent.index])}}\n  Type: ALIYUN::APIG::Policy\n  Properties:\n    GatewayId: {{Parameters.GatewayId}}\n    EnvironmentId: {{Parameters.EnvironmentId}}\n    PolicyClassName: {{item.PolicyClassName}}\n    PolicyConfig: {{item.PolicyConfig}}\n    AttachResourceIds: {{RosArray(RosOutput(Join([\"Route\", item.parent.index]), \"RouteId\"))}}\n    AttachResourceType: \"GatewayRoute\"\n{{/each}}\n{{#each Default(item.Plugins, [])}}\n{{#if or(item.PluginClassId, false)}}\nPlugin{{Join([item.parent.index, index])}}:\n  Type: ALIYUN::APIG::Plugin\n  MsaResource: true\n  Properties:\n    GatewayId: {{Parameters.GatewayId}}\n    PluginClassId: {{item.PluginClassId}}\n{{/if}}\n# 插件绑定到路由\nPluginAttachmentToRoute{{Join([item.parent.index, index])}}:\n  {{#if or(item.PluginClassId, false)}}\n  DependsOn:\n    - {{Join([\"Plugin\", item.parent.index, index])}}\n  {{/if}}\n  Type: ALIYUN::APIG::PluginAttachment\n  Properties:\n    EnvironmentId: {{Parameters.EnvironmentId}}\n    AttachResourceIds: {{RosArray(RosOutput(Join([\"Route\", item.parent.index]), \"RouteId\"))}}\n    Enable: true\n    PluginInfo:\n      GatewayId: {{Parameters.GatewayId}}\n      PluginId:\n        {{#if or(item.PluginClassId, false)}}\n        Fn::GetAtt:\n          - {{Join([\"Plugin\", item.parent.index, index])}}\n          - PluginId\n        {{else}}\n          {{item.PluginId}}\n        {{/if}}\n      PluginConfig:\n        Fn::Base64Encode: {{item.PluginConfig}}\n    AttachResourceType: {{Default(item.AttachResourceType, \"GatewayRoute\") }}\n{{/each}}\n{{/each}}","apig.service":"Service:\n  Type: ALIYUN::APIG::Service\n  MsaResource: true\n  Properties:\n    GatewayId: {{Parameters.GatewayId}}\n    ServiceName: {{Parameters.Name}}\n    SourceType: {{Default(Parameters.SourceType, 'DNS')}}\n{{#if or(eq(Parameters.SourceType, 'DNS'), eq(Parameters.SourceType, undefined))}}\n    Addresses:\n      Fn::Sub:\n        - '[\"${AddressesName}:${Port}\"]'\n        - AddressesName: {{Get(Parameters, \"DnsConfig.AddressesName\")}}\n          Port: {{Default(Get(Parameters, \"DnsConfig.Port\"), 80)}}\n{{/if}}\n    ServiceConfigs: {{Parameters.ServiceConfigs}}\n\n{{#if or(eq(Get(Parameters, \"DnsConfig.Port\"), 443), eq(Get(Parameters, \"DnsConfig.Port\"), 465))}}\nServiceTlsPolicy:\n  Type: ALIYUN::APIG::Policy\n  DependsOn:\n    - Service\n  Properties:\n    EnvironmentId: {{Parameters.EnvironmentId}}\n    AttachResourceIds:\n      Fn::Sub:\n        - '[\"${ResourceId}\"]'\n        - ResourceId:\n            Fn::GetAtt:\n            - Service\n            - ServiceId\n    PolicyClassName: \"ServiceTls\"\n    PolicyConfig:\n      Fn::Sub:\n        - '{\"mode\":\"SIMPLE\",\"sni\":\"${HOST}\",\"enable\":true}'\n        - HOST: {{Get(Parameters, \"DnsConfig.AddressesName\")}}\n    GatewayId: {{Parameters.GatewayId}}\n    AttachResourceType: \"GatewayService\"\n{{/if}}\n\n# 判断 Parameters.DnsConfig.AddressesName 存在\n{{#if Default(IsOSSWebsite(Get(Parameters, \"DnsConfig.AddressesName\")), false)}}\nOSSWebsite:\n  Type: ALIYUN::OSS::Website\n  Properties:\n    BucketName: {{Parameters.OssBucketName}}\n    WebsiteConfiguration:\n      IndexDocument:\n        Suffix: index.html\n        SupportSubDir: 'true'\n{{/if}}","cs.application":"ClusterApplication:\n  Type: ALIYUN::CS::ClusterApplication\n  Properties:\n    YamlContent: |\n{{#if Parameters.Namespace}}\n      apiVersion: v1\n      kind: Namespace\n      metadata:\n        name: {{Parameters.Namespace}}\n{{/if}}\n      ---\n      apiVersion: apps/v1\n      kind: Deployment\n      metadata:\n        name: {{Parameters.AppName}}\n        namespace: {{Default(Parameters.Namespace, 'default')}}\n      spec:\n        replicas: {{Default(Parameters.Replicas, 2)}}\n        selector:\n          matchLabels:\n            app: {{Parameters.AppName}}\n        template:\n          metadata:\n            labels:\n              app: {{Parameters.AppName}}\n          spec:\n            containers:\n              - image: {{Parameters.Image}}\n                imagePullPolicy: Always\n                name: {{Parameters.AppName}}\n                resources: {}\n      ---\n      apiVersion: v1\n      kind: Service\n      metadata:\n        name: {{Join([Parameters.AppName, \"-\" ,\"svc\"])}}\n        namespace: {{Default(Parameters.Namespace, 'default')}}\n      spec:\n        ports:\n          - port: {{Parameters.Port}}\n            protocol: TCP\n            targetPort:  {{Parameters.Port}}\n        selector:\n          app: {{Parameters.AppName}}\n        type: ClusterIP\n    ClusterId: {{Parameters.ClusterId}}\n    DefaultNamespace: {{Parameters.Namespace}}\n    ValidationMode: Basic\n    Stage: All","ecs.group":"SecurityGroup:\n  Type: ALIYUN::ECS::SecurityGroup\n  Properties:\n    SecurityGroupIngress:\n      - Priority: 1\n        PortRange: 80/80\n        NicType: internet\n        SourceCidrIp: 0.0.0.0/0\n        IpProtocol: tcp\n    VpcId:  {{Parameters.VpcId}}\n    SecurityGroupName:\n      Ref: ALIYUN::StackName\n\nInstanceGroup:\n  Type: ALIYUN::ECS::InstanceGroup\n  Properties:\n    SystemDiskCategory: cloud_essd\n    VpcId: {{Parameters.VpcId}}\n    InstanceChargeType: PostPaid\n    Password: {{Parameters.InstancePassword}}\n    SecurityGroupId:\n      Fn::GetAtt:\n        - SecurityGroup\n        - SecurityGroupId\n    SystemDiskSize: 200\n    InternetMaxBandwidthOut: 5\n    VSwitchId: {{Parameters.VSwitchId}}\n    IoOptimized: optimized\n    ImageId: m-bp1e27qht70nrda0qtaz\n    InstanceType: 'ecs.u1-c1m2.xlarge'\n    MaxAmount: 1\n\nRunInstallCommand:\n  Type: ALIYUN::ECS::RunCommand\n  Properties:\n    Type: RunShellScript\n    CommandContent:\n      Fn::Sub:\n        - |\n          systemctl start dify\n          sleep 10\n          ARGUS_VERSION=3.5.7 /bin/bash -c \"$(curl -sS https://cms-agent-${RegionId}.oss-${RegionId}-internal.aliyuncs.com/Argus/agent_install_ecs-1.7.sh)\" >> /root/install_cms_agent.log 2>&1\n        - RegionId:\n            Ref: ALIYUN::Region\n    Sync: true\n    InstanceIds:\n      Fn::GetAtt:\n        - InstanceGroup\n        - InstanceIds\n    Timeout: 3600\n","fc3":"Function:\n  Type: ALIYUN::FC3::Function\n  MsaResource: true\n  Properties:\n    Handler: {{Parameters.Handler}}\n    Description: {{Parameters.Description}}\n    FunctionName: {{Parameters.Name}}\n    MemorySize: {{Parameters.Memory || 1024}}\n    DiskSize: {{Parameters.DiskSize || 512}}\n    Runtime: {{Parameters.Runtime || \"custom-container\"}}\n    Cpu: {{Parameters.Cpu || 1}}\n    InternetAccess: {{Parameters.InternetAccess || true}}\n    CustomContainerConfig: {{Parameters.CustomContainerConfig}}\n    EnvironmentVariables: {{Parameters.EnvironmentVariables}}\n    Timeout: {{Parameters.Timeout || 3}}\n\nHttpTrigger:\n  Type: ALIYUN::FC3::Trigger\n  DependsOn: Function\n  Properties:\n    FunctionName:\n      Fn::GetAtt:\n        - Function\n        - FunctionName\n    TriggerName: {{Parameters.Name || httpTrigger}}\n    TriggerConfig: >-\n      {\"authType\":\"anonymous\",\"methods\":[\"GET\",\"POST\",\"PUT\",\"DELETE\"],\"disableURLInternet\":false}\n    TriggerType: http\n    Qualifier: 'LATEST'\n\n","nacos":"Resources:\n  MSECluster:\n    Type: ALIYUN::MSE::Cluster\n    MsaResource: true\n    Properties:\n      InstanceCount: 1\n      MseVersion: mse_dev\n      ClusterVersion: NACOS_2_0_0\n      PubNetworkFlow: 0\n      ClusterType: Nacos-Ans\n      ConnectionType: eni\n      NetType: privatenet\n      # 规格 1核2G\n      ClusterSpecification: MSE_SC_1_2_60_c\n      ClusterAliasName: {{Parameters.ClusterName}}\n","oss":"{{#if or(Parameters.isOssWebsite, Parameters.GatewayId)}}\nOSSWebsite:\n  Type: ALIYUN::OSS::Website\n  Properties:\n    BucketName: {{Parameters.OssBucketName}}\n    WebsiteConfiguration:\n      IndexDocument:\n        Suffix: index.html\n        SupportSubDir: 'true'\n{{/if}}","sae":"Namespace:\n  Type: ALIYUN::SAE::Namespace\n  Properties:\n    NamespaceName: {{Default(Parameters.NamespaceName, Parameters.NamespaceId)}}\n    NamespaceId: {{Join([Parameters.Region, \":\", Parameters.NamespaceId])}}\n    NamespaceDescription: {{Parameters.NamespaceDescription}}\n\nSecurityGroup:\n  Type: 'ALIYUN::ECS::SecurityGroup'\n  Properties:\n    VpcId: {{Parameters.VpcId}}\n    SecurityGroupIngress:\n      - PortRange: {{Join([Parameters.ContainerPort, \"/\",Parameters.ContainerPort])}}\n        Priority: 1\n        SourceCidrIp: 0.0.0.0/0\n        IpProtocol: tcp\n    SecurityGroupName: {{Join(['sg', \"-\",Parameters.AppName])}}\n    \nApplication:\n  Type: ALIYUN::SAE::Application\n  DependsOn: Namespace\n  Properties:\n    PackageType: Image\n    ImageUrl: {{Parameters.ImageUrl}}\n    Replicas: {{Default(Parameters.Replicas, 2)}}\n    NamespaceId: {{Join([Parameters.Region, \":\",Parameters.NamespaceId])}}\n    AppName: {{Parameters.AppName}}\n    Cpu: {{Default(Parameters.Cpu, 1000)}}\n    Memory: {{Default(Parameters.Memory, 2048)}}\n    Timezone: Asia/Shanghai\n    VpcId: {{Parameters.VpcId}}\n    VSwitchId: {{Parameters.VSwitchId}}\n    SecurityGroupId: \n      Fn::GetAtt:\n        - SecurityGroup\n        - SecurityGroupId\n    PvtzDiscoverySvc: \n      Fn::Sub:\n        - '{\"serviceName\":\"${ServiceName}\",\"namespaceId\":\"${NamespaceId}\",\"portAndProtocol\":{\"80\":\"TCP\"},\"enable\":true}'\n        - Region:\n            Ref: ALIYUN::Region\n          NamespaceId:\n            Ref: SaeNamespace\n          ServiceName:\n            Fn::Join:\n              - \"-\"\n              - - sae-base\n                - Fn::Replace:\n                  - ':': '-'\n                  - Ref: SaeNamespace\n  "}